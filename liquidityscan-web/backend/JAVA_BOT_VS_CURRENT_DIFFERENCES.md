# Различия между Java ботом (tradingBot.jar) и текущей реализацией

## Обзор

Этот документ описывает ключевые различия между оригинальным Java ботом и текущей реализацией в TypeScript/NestJS.

---

## 1. Таймфреймы для стратегий

### Super Engulfing

| Таймфрейм | Java бот | Текущая реализация | Различие |
|-----------|----------|-------------------|----------|
| **1h** | ✅ Да (с проверкой времени 10:00-21:00) | ❌ Нет | **КРИТИЧЕСКОЕ:** В текущей реализации отсутствует 1h таймфрейм |
| **4h** | ✅ Да (с проверкой времени 10:00-21:00) | ✅ Да | ✅ Совпадает |
| **1d** | ✅ Да (без проверки времени) | ✅ Да | ✅ Совпадает |
| **1w** | ✅ Да (без проверки времени) | ✅ Да | ✅ Совпадает |
| **5m** | ❌ Нет | ❌ Нет | ✅ Совпадает |
| **15m** | ❌ Нет | ❌ Нет | ✅ Совпадает |

**Вывод:** В Java боте Super Engulfing работает на 1h с проверкой времени, в текущей реализации этого нет.

---

### RSI Divergence

| Таймфрейм | Java бот | Текущая реализация | Различие |
|-----------|----------|-------------------|----------|
| **1h** | ✅ Да (с проверкой времени 10:00-21:00) | ✅ Да | ⚠️ **Различие:** В Java боте есть проверка времени, в текущей реализации нет |
| **4h** | ✅ Да (с проверкой времени 10:00-21:00) | ✅ Да | ⚠️ **Различие:** В Java боте есть проверка времени, в текущей реализации нет |
| **1d** | ❓ Не ясно из байт-кода | ✅ Да | ⚠️ Требует проверки |
| **5m** | ❌ Нет (только RSI alerts) | ❌ Нет | ✅ Совпадает |
| **15m** | ❌ Нет (только RSI alerts) | ❌ Нет | ✅ Совпадает |

**Вывод:** В Java боте RSI Divergence на 1h и 4h работает только в рабочее время (10:00-21:00), в текущей реализации проверка времени отсутствует.

---

### ICT Daily Bias

| Таймфрейм | Java бот | Текущая реализация | Различие |
|-----------|----------|-------------------|----------|
| **1d** | ✅ Да (только для 1d) | ✅ Да | ✅ Совпадает |
| **1w** | ❌ Нет | ✅ Да | ⚠️ **Различие:** В текущей реализации есть 1w, в Java боте нет |
| **4h** | ❌ Нет | ✅ Да | ⚠️ **Различие:** В текущей реализации есть 4h, в Java боте нет |

**Вывод:** В Java боте ICT Bias работает только на 1d, в текущей реализации добавлены 4h и 1w.

---

### Hammer Pattern

| Таймфрейм | Java бот | Текущая реализация | Различие |
|-----------|----------|-------------------|----------|
| **Все таймфреймы** | ✅ Да (5m, 15m, 1h, 4h, 1d, 1w) | ❌ Не реализован | **КРИТИЧЕСКОЕ:** В текущей реализации Hammer не реализован |

**Вывод:** В Java боте есть стратегия Hammer на всех таймфреймах, в текущей реализации она отсутствует.

---

## 2. Время генерации сигналов

### Java бот

- **Временная зона:** Asia/Yerevan
- **Рабочее время:** 10:00 - 21:00
- **Kill Zone:** 17:00 - 20:00 (для модификации сообщений Super Engulfing)
- **Проверка времени:**
  - Super Engulfing на 1h и 4h: только в 10:00-21:00
  - RSI Divergence на 1h и 4h: только в 10:00-21:00
  - Super Engulfing на 1d и 1w: всегда
  - ICT Bias на 1d: всегда
  - Hammer: всегда

### Текущая реализация

- **Временная зона:** UTC (по умолчанию)
- **Расписание:** Cron jobs с 30-секундной задержкой после закрытия свечи
  - 1h: каждые 60 минут в :00:30
  - 4h: каждые 4 часа в :00:30 (00:00, 04:00, 08:00, 12:00, 16:00, 20:00)
  - 1d: ежедневно в 04:00:30 UTC
  - 1w: понедельник в 04:00:30 UTC
- **Проверка времени:** ❌ Отсутствует

**Вывод:** В текущей реализации нет проверки рабочего времени (10:00-21:00), сигналы генерируются в любое время суток.

---

## 3. Параметры стратегий

### RSI Divergence

| Параметр | Java бот | Текущая реализация | Совпадает? |
|----------|----------|-------------------|------------|
| **Период RSI** | 14 | 14 | ✅ Да |
| **Left bars** | 5 | 5 | ✅ Да |
| **Right bars** | 5 | 5 | ✅ Да |
| **Min расстояние** | 5 свечей | 5 свечей | ✅ Да |
| **Max расстояние** | 60 свечей | 60 свечей | ✅ Да |
| **Фильтр RSI (Bullish)** | Не видно в байт-коде | < 30 (oversold) | ⚠️ Различие |
| **Фильтр RSI (Bearish)** | Не видно в байт-коде | > 70 (overbought) | ⚠️ Различие |
| **Фильтр RSI диапазон** | 35-65 (для проверки валидности) | Нет | ⚠️ Различие |

**Вывод:** Базовые параметры совпадают, но есть различия в фильтрах RSI значений.

---

### Super Engulfing

| Параметр | Java бот | Текущая реализация | Совпадает? |
|----------|----------|-------------------|------------|
| **Базовый Engulfing** | ✅ Да | ✅ Да | ✅ Да |
| **2X (с фитилем)** | ✅ Да | ✅ Да | ✅ Да |
| **3X (тройное)** | ✅ Да | ✅ Да | ✅ Да |
| **RSI фильтр для 1h** | 40-60 | ❌ Нет (1h не реализован) | ⚠️ Различие |
| **RUN/REV паттерны** | ❌ Нет | ✅ Да | ⚠️ Различие |
| **x Logic** | ❌ Нет | ✅ Да | ⚠️ Различие |
| **PLUS модификатор** | ❌ Нет | ✅ Да | ⚠️ Различие |

**Вывод:** В текущей реализации добавлены RUN/REV паттерны, x Logic и PLUS модификатор, которых нет в Java боте. Но отсутствует 1h таймфрейм с RSI фильтром.

---

### ICT Daily Bias

| Параметр | Java бот | Текущая реализация | Совпадает? |
|----------|----------|-------------------|------------|
| **Логика Bullish** | prevClose > prevHigh | prevClose > prevHigh | ✅ Да |
| **Логика Bearish** | prevClose < prevLow | prevClose < prevLow | ✅ Да |
| **Логика Ranging** | prevClose между High/Low | prevClose между High/Low | ✅ Да |
| **Таймфреймы** | Только 1d | 4h, 1d, 1w | ⚠️ Различие |

**Вывод:** Логика совпадает, но таймфреймы различаются.

---

## 4. Логика Super Engulfing

### Java бот

```java
// Бычий Engulfing:
- Предыдущая свеча: бычья (зеленая)
- Текущая свеча: медвежья (красная)
- Low текущей < Low предыдущей
- Close текущей > Open предыдущей

// Медвежий Engulfing:
- Предыдущая свеча: медвежья (красная)
- Текущая свеча: бычья (зеленая)
- High текущей > High предыдущей
- Close текущей < Open предыдущей
```

### Текущая реализация

```typescript
// RUN (Continuation):
- Bullish RUN: prevBull AND currBull AND low < low[1] AND close > close[1]
- Bearish RUN: prevBear AND currBear AND high > high[1] AND close < close[1]

// REV (Reversal):
- Bullish REV: prevBear AND currBull AND low < low[1] AND close > open[1]
- Bearish REV: prevBull AND currBear AND high > high[1] AND close < open[1]

// PLUS Modifier:
- RUN+: RUN pattern + close > high[1] (bull) or close < low[1] (bear)
- REV+: REV pattern + close > high[1] (bull) or close < low[1] (bear)
```

**Вывод:** Текущая реализация использует другую логику (RUN/REV вместо классического Engulfing), которая более сложная и включает дополнительные паттерны.

---

## 5. Количество анализируемых монет

| Параметр | Java бот | Текущая реализация | Различие |
|----------|----------|-------------------|----------|
| **Количество** | 343 монеты (жестко закодировано) | 300+ монеты (из конфига) | ⚠️ Различие |
| **Источник** | Массив в коде | ENV переменная или БД | ⚠️ Различие |

**Вывод:** В Java боте 343 монеты жестко закодированы, в текущей реализации используется конфигурация.

---

## 6. Расписание выполнения

### Java бот

- Использует `ScheduledExecutorService` с динамическими интервалами
- Интервалы зависят от таймфрейма:
  - 1h: каждые 3600000 мс (1 час)
  - 4h: каждые 14400000 мс (4 часа)
  - 1d: каждые 86400000 мс (1 день)
  - 1w: каждые 604800000 мс (1 неделя)
  - 5m и 15m: используют дневной интервал

### Текущая реализация

- Использует NestJS `@Cron` декораторы
- Фиксированное расписание:
  - 1h: `30 * * * *` (каждый час в :00:30)
  - 4h: `30 0,4,8,12,16,20 * * *` (каждые 4 часа в :00:30)
  - 1d: `30 4 * * *` (ежедневно в 04:00:30 UTC)
  - 1w: `30 4 * * 1` (понедельник в 04:00:30 UTC)

**Вывод:** Подход к расписанию различается: Java бот использует динамические интервалы, текущая реализация - фиксированные cron выражения.

---

## 7. RSI Alerts (5m-rsi, 15m-rsi)

| Параметр | Java бот | Текущая реализация | Различие |
|----------|----------|-------------------|----------|
| **5m-rsi** | ✅ Да (каждые 5 минут) | ❌ Нет | **КРИТИЧЕСКОЕ:** Отсутствует |
| **15m-rsi** | ✅ Да (каждые 15 минут) | ❌ Нет | **КРИТИЧЕСКОЕ:** Отсутствует |
| **1h RSI** | ✅ Да (каждые 60 минут) | ❌ Нет | **КРИТИЧЕСКОЕ:** Отсутствует |

**Вывод:** В Java боте есть отдельные задачи для RSI alerts на коротких таймфреймах, в текущей реализации они отсутствуют.

---

## Резюме критических различий

### ❌ Отсутствует в текущей реализации:

1. **Super Engulfing на 1h таймфрейме** (с RSI фильтром 40-60)
2. **Hammer Pattern** на всех таймфреймах
3. **RSI Alerts** на 5m, 15m, 1h
4. **Проверка рабочего времени** (10:00-21:00 Asia/Yerevan)
5. **Kill Zone** (17:00-20:00) для модификации сообщений

### ✅ Добавлено в текущей реализации:

1. **RUN/REV паттерны** для Super Engulfing
2. **x Logic** для Super Engulfing
3. **PLUS модификатор** для Super Engulfing
4. **ICT Bias на 4h и 1w** (в Java боте только 1d)
5. **RSI фильтры** (< 30 для bullish, > 70 для bearish)

### ⚠️ Различия в логике:

1. **Super Engulfing:** Текущая реализация использует RUN/REV вместо классического Engulfing
2. **Расписание:** Разные подходы (динамические интервалы vs фиксированные cron)
3. **Временная зона:** Java бот использует Asia/Yerevan, текущая реализация - UTC

---

## Рекомендации по синхронизации

1. **Добавить Super Engulfing на 1h** с проверкой времени и RSI фильтром
2. **Реализовать Hammer Pattern** на всех таймфреймах
3. **Добавить RSI Alerts** на 5m, 15m, 1h
4. **Добавить проверку рабочего времени** для Super Engulfing и RSI Divergence на 1h/4h
5. **Добавить Kill Zone** для модификации сообщений Super Engulfing
6. **Синхронизировать временную зону** (Asia/Yerevan вместо UTC)
7. **Убрать ICT Bias с 4h и 1w** (оставить только 1d, как в Java боте)
