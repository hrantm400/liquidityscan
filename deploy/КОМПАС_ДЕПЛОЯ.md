# Компас деплоя LiquidityScan — всё по порядку (максимально подробно)

Один файл: что делать по шагам, от загрузки кода в GitHub до работающего сайта на https://liquidityscan.io.  
Сервер: **173.249.3.156**. Домен: **liquidityscan.io** (Namecheap).  
**На сервере уже есть superengulfing — его не трогать.**

---

## Сводка: что делаем в каком шаге

| Шаг | Где | Что делаем |
|-----|-----|------------|
| 1 | Твой компьютер (терминал) | Заливаем код на GitHub: открыть папку проекта, при необходимости создать репозиторий на GitHub, выполнить git add / commit / push. |
| 2 | Сервер (после SSH) | Подключаемся по SSH, проверяем/ставим Node, git, PM2, PostgreSQL. |
| 3 | Сервер | Клонируем репозиторий с GitHub в `/var/www/liquidityscan`. |
| 4 | Сервер | В папке backend: npm ci, создать .env, prisma generate и migrate, build, запуск через PM2. |
| 5 | Сервер | В папке frontend: npm ci, build. |
| 6 | Сервер | Nginx: скопировать конфиг для liquidityscan.io, включить сайт, перезагрузить nginx. |
| 7 | Браузер (Namecheap) | В DNS добавить A-записи @ и www → 173.249.3.156. |
| 8 | Сервер | Установить certbot, выдать SSL для liquidityscan.io; обновить .env на https, перезапустить PM2. |
| 9 | Браузер (Google Console) | В OAuth добавить origins и redirect URI для https://liquidityscan.io. |
| 10 | — | Передать разработчику Grno webhook URL и секрет. |
| 11 | Браузер | Проверить сайт, вход через Google, API, что superengulfing работает. |

---

## Где вводить команды

- **Шаг 1 (GitHub):** команды вводишь **на своём компьютере** — в терминале Cursor (вкладка Terminal внизу) или в PowerShell / командной строке. Папка должна быть **корень проекта** (та, где лежат папки `liquidityscan-web` и `deploy`).
- **Шаги 2–8 (сервер):** команды вводишь **на сервере** — после того как подключился по SSH (`ssh root@173.249.3.156`). То есть сначала подключаешься к серверу, потом вводишь команды из шагов 2–8.
- **Шаги 7 и 9 (Namecheap, Google):** это делается в браузере (сайты Namecheap и Google Cloud Console).

---

## Что нужно иметь до начала

- Аккаунт на **GitHub.com** (бесплатный).
- **Git** на компьютере (часто уже стоит; проверишь в шаге 1).
- SSH на сервер: `ssh root@173.249.3.156` (логин и пароль или ключ).
- Аккаунт Namecheap с доменом liquidityscan.io.
- В Google Cloud Console: OAuth 2.0 Client ID (Client ID и Client Secret) для входа через Google.
- На сервере 173.249.3.156: PostgreSQL (или возможность его установить и создать БД для LiquidityScan).

---

## Шаг 0. Что на сервере не трогать

Перед любыми действиями на сервере запомни:

- **Nginx:** не менять файлы `superengulfing` и `default` в `/etc/nginx/sites-available/` и их симлинки в `sites-enabled/`.
- **Папки:** не удалять и не менять `/var/www/superengulfing`, `/var/www/html`.
- **PM2:** не останавливать и не удалять процессы **api** и **remix** (это superengulfing).

Все команды ниже только **добавляют** LiquidityScan и не меняют superengulfing.

---

## Шаг 1. Залить проект в GitHub (очень подробно)

**Зачем:** GitHub — это сайт, где хранится код. Сервер потом скачает код с GitHub командой `git clone`. Сначала нужно загрузить (запушить) код со своего компьютера на GitHub.

**Где делаем:** на своём компьютере, в папке с проектом. Команды вводим в терминале (в Cursor: меню Terminal → New Terminal, или внизу экрана вкладка Terminal).

---

### 1.1. Открыть терминал и перейти в папку проекта

1. В Cursor открой терминал: **Terminal → New Terminal** (или сочетание клавиш для терминала).
2. В терминале ты увидишь строку вроде `PS C:\Users\hrant\...` или `C:\...`. Это текущая папка.
3. Нужно перейти в папку, где лежит твой проект LiquidityScan (там должны быть папки `liquidityscan-web` и `deploy`).  
   Пример, если проект на рабочем столе в папке `liquidityscan -MEGA`:

   ```bash
   cd "C:\Users\hrant\Desktop\liquidityscan -MEGA"
   ```

   Подставь свой путь, если он другой. Путь с пробелами обязательно в кавычках.
4. Проверь, что ты в нужной папке — введи:

   ```bash
   dir
   ```

   (В Linux/Mac было бы `ls`.) Должны появиться папки `liquidityscan-web`, `deploy`, файл `.gitignore` и т.д.

---

### 1.2. Проверить, установлен ли Git

Введи:

```bash
git --version
```

- Если появилось что-то вроде `git version 2.x.x` — Git установлен, идёшь дальше.
- Если команда не найдена — установи Git с https://git-scm.com/download/win и перезапусти терминал.

---

### 1.3. Создать репозиторий на GitHub (если ещё нет)

1. Открой в браузере https://github.com и войди в аккаунт.
2. Справа вверху нажми зелёную кнопку **New** (или **Create repository**).
3. В поле **Repository name** введи название, например: `liquidityscan`.
4. Оставь **Public**. Не ставь галочку "Add a README" (у тебя уже есть проект).
5. Нажми **Create repository**.
6. На следующей странице GitHub покажет команды. Там будет URL репозитория, например:  
   `https://github.com/ТВОЙ_ЛОГИН/liquidityscan.git`  
   **Скопируй этот URL** — он понадобится ниже. Пока страницу можно не закрывать.

---

### 1.4. Инициализировать Git в папке проекта (если ещё не инициализирован)

В терминале (в папке проекта) введи:

```bash
git status
```

- Если видишь текст вроде **"On branch main"** и список файлов — Git уже инициализирован, переходи к пункту 1.5.
- Если видишь **"not a git repository"** — значит Git в этой папке ещё не настроен. Тогда выполни по очереди:

  ```bash
  git init
  git branch -M main
  ```

  Потом нужно будет один раз привязать удалённый репозиторий (пункт 1.5).

---

### 1.5. Привязать удалённый репозиторий GitHub (один раз)

Если ты только что создал репозиторий на GitHub и сделал `git init`, нужно сказать Git, куда пушить. Подставь **свой** URL репозитория вместо примера:

```bash
git remote add origin https://github.com/ТВОЙ_ЛОГИН/ТВОЙ_РЕПОЗИТОРИЙ.git
```

Пример: если твой логин `hrmelk` и репозиторий называется `liquidityscan`, то:

```bash
git remote add origin https://github.com/hrmelk/liquidityscan.git
```

Если команда выдаст ошибку **"remote origin already exists"** — значит привязка уже есть, ничего не делай, иди дальше.

Проверить, какой URL привязан:

```bash
git remote -v
```

Должны быть две строки с твоим URL (fetch и push).

---

### 1.6. Убедиться, что секреты не попадут в GitHub

В корне проекта должен быть файл `.gitignore`. В нём должны быть строки про `.env`, `node_modules`, `dist`. Тогда пароли и секреты из `.env` не попадут в репозиторий. Проверка:

```bash
type .gitignore
```

(В Linux/Mac: `cat .gitignore`.) Должны быть упоминания `.env`, `node_modules`, `dist`. Если этого нет — не добавляй вручную секреты в репозиторий; в проекте уже есть подготовленный `.gitignore`.

---

### 1.7. Добавить все файлы, сделать коммит и отправить на GitHub

Выполни команды **по очереди**, после каждой нажимай Enter.

**Команда 1 — посмотреть, что изменилось:**

```bash
git status
```

Будут видны файлы (modified/untracked). Это нормально.

**Команда 2 — добавить все файлы в «корзину» для отправки:**

```bash
git add .
```

Точка в конце обязательна. Ничего не напишет — так и должно быть.

**Команда 3 — сохранить снимок с комментарием (коммит):**

```bash
git commit -m "Deploy: готово к деплою на сервер и домен"
```

Может написать сколько файлов изменено. Если напишет **"nothing to commit"** — значит всё уже закоммичено, можно сразу переходить к команде 4.

**Команда 4 — отправить код на GitHub (push):**

```bash
git push -u origin main
```

- Если ветка у тебя называется не `main`, а например `master`, замени: `git push -u origin master`.
- При первом push браузер или Git может спросить логин/пароль GitHub. Логин — твой GitHub username, пароль — **не** обычный пароль, а **Personal Access Token** (GitHub → Settings → Developer settings → Personal access tokens → создать token с правом repo). Либо используй **GitHub Desktop** или **Git Credential Manager**, если они запросят вход.

После успешного push в терминале появится что-то вроде:  
`Writing objects: 100% ... done` и `main -> main`.

**Команда 5 — проверить на сайте:**

Открой в браузере свой репозиторий, например:  
`https://github.com/ТВОЙ_ЛОГИН/ТВОЙ_РЕПОЗИТОРИЙ`  
Там должны быть папки `liquidityscan-web`, `deploy` и файлы. Значит, код на GitHub.

**Запомни URL репозитория** в формате для clone, например:  
`https://github.com/ТВОЙ_ЛОГИН/ТВОЙ_РЕПОЗИТОРИЙ.git`  
Он понадобится на сервере в шаге 3.

---

## Шаг 2. Подключиться к серверу и установить необходимое

**Где:** эти команды вводишь **после** того как подключился к серверу. Подключение — с твоего компьютера (в том же терминале или в отдельном окне).

---

### 2.1. Подключиться к серверу по SSH

На своём компьютере в терминале (PowerShell или Cursor Terminal) введи:

```bash
ssh root@173.249.3.156
```

Нажми Enter. Может спросить:
- **"Are you sure you want to continue connecting?"** — введи `yes` и Enter.
- **Password:** введи пароль от сервера (при вводе символы не отображаются — так и должно быть), потом Enter.

Когда подключишься, в начале строки появится что-то вроде `root@vmi3063021:~#` — значит ты уже **на сервере**. Все следующие команды (шаги 2–6 и 8) вводи здесь, пока не отключишься.

---

### 2.2. Проверить Node и npm (нужен Node 18 или 20)

Введи по очереди:

```bash
node -v
```

Должно вывести версию, например `v20.10.0`. Если команда не найдена или версия очень старая — установи Node так:

```bash
apt update
apt install -y curl
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs
```

Потом снова проверь: `node -v` и `npm -v`.

---

### 2.3. Установить git и PM2 (если ещё нет)

```bash
apt install -y git
npm install -g pm2
```

После этого можно проверить: `git --version` и `pm2 -v`.

---

### 2.4. Проверить PostgreSQL (база данных для бэкенда)

```bash
psql --version
```

Если команда не найдена — установи PostgreSQL (например `apt install postgresql postgresql-contrib`), затем создай базу и пользователя (см. ниже).

**Пароль для БД — откуда он берётся?**  
Его нигде не «ищешь». Ты **сам задаёшь** его при создании пользователя PostgreSQL. В проекте в скрипте `create-db-user.sql` по умолчанию задан пароль **`liquidityscan_password`**. Если создашь пользователя этим скриптом (команды ниже) — в шаге 4 в `DATABASE_URL` и пиши этот пароль.

**Создать базу и пользователя на сервере (один раз):**

```bash
cd /var/www/liquidityscan/liquidityscan-web/backend
sudo -u postgres psql -h localhost -f scripts/create-db-user.sql
```

Скрипт создаст пользователя **liquidityscan** с паролем **liquidityscan_password** и базу **liquidityscan_db**. Если выдаст ошибку «database already exists» — значит база уже есть, просто используй в `.env` тот пароль, которым создавал пользователя (или `liquidityscan_password`, если тогда не менял скрипт).

---

## Шаг 3. Клонировать репозиторий на сервер

**Где:** на сервере (ты уже подключён по SSH, строка типа `root@vmi3063021:~#`).

**Что делаем:** скачиваем код с GitHub в папку `/var/www/liquidityscan`. URL репозитория ты получил в шаге 1 (например `https://github.com/hrmelk/liquidityscan.git`).

---

### 3.1. Перейти в папку www и выполнить clone

Введи:

```bash
cd /var/www
```

Потом команду clone. **Замени** `https://github.com/ТВОЙ_USER/ТВОЙ_REPO.git` на **свой** URL репозитория (тот же, что использовал для push в шаге 1):

```bash
git clone https://github.com/hrantm400/liquidityscan.git liquidityscan
```

(Это твой репозиторий. Если бы использовал другой — заменил бы URL.)

Слово `liquidityscan` в конце — это имя папки на сервере; она создастся в `/var/www/liquidityscan`.  
Если репозиторий приватный, может спросить логин/пароль GitHub (или использовать токен).

---

### 3.2. Проверить, что файлы на месте

Введи по очереди:

```bash
ls -la /var/www/liquidityscan/liquidityscan-web/backend
ls -la /var/www/liquidityscan/liquidityscan-web/frontend
ls -la /var/www/liquidityscan/deploy
```

В каждой команде должны появиться списки файлов (package.json в backend и frontend, в deploy — конфиги nginx и т.д.).  
Если у тебя в репозитории нет папки `liquidityscan-web` в корне, а backend и frontend лежат прямо в корне, тогда пути будут такие: `/var/www/liquidityscan/backend` и `/var/www/liquidityscan/frontend`. В следующих шагах везде подставляй эти пути (без `liquidityscan-web/`).

---

## Шаг 4. Настроить и запустить бэкенд

**Где:** на сервере, в терминале после SSH.

---

### 4.1. Перейти в папку бэкенда

```bash
cd /var/www/liquidityscan/liquidityscan-web/backend
```

После Enter строка может выглядеть так: `root@vmi3063021:/var/www/liquidityscan/liquidityscan-web/backend#` — значит ты в нужной папке.

---

### 4.2. Установить зависимости

```bash
npm ci
```

Подожди, пока установятся пакеты. В конце снова появится приглашение ввести команду.

---

### 4.3. Создать файл .env и открыть его для редактирования

Сначала скопировать пример:

```bash
cp .env.example .env
```

Потом открыть файл в редакторе nano:

```bash
nano .env
```

Откроется экран с текстом. Внизу подсказки: `^O` — сохранить, `^X` — выйти (буква O и X, не ноль).

---

### 4.4. Заполнить переменные в .env

Курсором (стрелками) дойди до каждой строки и замени значение на своё. Не удаляй названия переменных (например `DATABASE_URL=`), меняй только то, что после `=`.

Что обязательно подставить:

| Переменная | Что написать |
|------------|--------------|
| DATABASE_URL | Строка подключения к PostgreSQL. Если создавал пользователя скриптом из шага 2.4 — пароль там **liquidityscan_password**. Пиши: `postgresql://liquidityscan:liquidityscan_password@localhost:5432/liquidityscan_db?schema=public` (если при создании пользователя задавал другой пароль — подставь его вместо `liquidityscan_password`). |
| PORT | Цифра `3002` (без кавычек). |
| JWT_SECRET | Любая длинная случайная строка, например `moj_super_sekret_123_xyz`. |
| JWT_REFRESH_SECRET | Другая случайная строка. |
| GOOGLE_CLIENT_ID | Скопируй из Google Cloud Console (OAuth 2.0 Client ID). |
| GOOGLE_CLIENT_SECRET | Скопируй из Google Cloud Console. |
| GOOGLE_CALLBACK_URL | Пока: `http://liquidityscan.io/api/auth/google/callback` (после SSL поменяешь на `https://...`). |
| CORS_ORIGIN | `https://liquidityscan.io` (до SSL можно `http://liquidityscan.io`). |
| FRONTEND_URL | `https://liquidityscan.io` (до SSL — `http://liquidityscan.io`). |
| SIGNALS_WEBHOOK_SECRET | Любая длинная строка (её потом передашь разработчику Grno), например `ls_webhook_secret_xyz_123`. |
| ADMIN_EMAILS | Твой email, например `hromelkyan@gmail.com`. |

**Как сохранить и выйти из nano:**  
1) Нажми **Ctrl+O** (удерживая Ctrl, нажми O) — внизу спросит имя файла; нажми **Enter**.  
2) Потом **Ctrl+X** — выйдешь из редактора в терминал.

---

### 4.5. Сгенерировать Prisma и применить миграции

```bash
npx prisma generate
npx prisma migrate deploy
```

Если миграций ещё нет или используешь `db push`:

```bash
npx prisma db push
```

**4.6.** Собери бэкенд и запусти через PM2:

```bash
npm run build
pm2 start ecosystem.config.cjs
pm2 save
pm2 startup
```

Команду от `pm2 startup` (если выведет) выполни так, как она показана — чтобы бэкенд поднимался после перезагрузки сервера.

**4.7.** Проверь, что API отвечает:

```bash
curl -s http://127.0.0.1:3002/api/health
```

Должен вернуться JSON. Если ошибка — смотри логи: `pm2 logs liquidityscan-api`.

---

## Шаг 5. Собрать фронтенд

**5.1.** Перейди в папку фронта:

```bash
cd /var/www/liquidityscan/liquidityscan-web/frontend
```

**5.2.** Установи зависимости (флаг нужен из-за совместимости с React 19):

```bash
npm ci --legacy-peer-deps
```

**5.3.** Если при следующей команде появится ошибка `vite: Permission denied`, выполни:

```bash
chmod +x node_modules/.bin/*
```

**5.4.** Собери продакшен-сборку:

```bash
npm run build
```

**5.5.** Проверь, что появилась папка со сборкой:

```bash
ls -la dist
```

Должны быть `index.html` и папка `assets/`.

---

## Шаг 6. Настроить Nginx для liquidityscan.io

**6.1.** Скопируй конфиг из репозитория в Nginx (только новый файл, superengulfing и default не трогай):

```bash
sudo cp /var/www/liquidityscan/deploy/nginx-liquidityscan-domain.conf /etc/nginx/sites-available/liquidityscan.io
```

**6.2.** Проверь путь к статике в конфиге (должен совпадать с тем, где у тебя лежит `frontend/dist`):

```bash
grep root /etc/nginx/sites-available/liquidityscan.io
```

Ожидается: `root /var/www/liquidityscan/liquidityscan-web/frontend/dist;`  
Если ты клонировал в другую папку или структура другая — открой конфиг и поправь `root`:

```bash
sudo nano /etc/nginx/sites-available/liquidityscan.io
```

**6.3.** Включи сайт и перезагрузи Nginx:

```bash
sudo ln -sf /etc/nginx/sites-available/liquidityscan.io /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

Если `nginx -t` выдал ошибку — исправь конфиг (чаще всего путь в `root`).

Пока DNS не указывает на этот сервер, по домену сайт не откроется. Дальше настраиваем DNS.

---

## Шаг 7. Настроить DNS (домен на сервер)

Есть два варианта:
- **7.1–7.5** — только Namecheap: DNS указывает напрямую на сервер (173.249.3.156).
- **7.6** — трафик через **Cloudflare**: домен в Cloudflare, DNS в Cloudflare, весь трафик идёт через их CDN (рекомендуется, если хочешь защиту и кэш).

Выбери один вариант и выполни соответствующие подпункты.

---

### 7.1. Открыть управление доменом (вариант: только Namecheap)

1. Зайди на https://www.namecheap.com и войди в аккаунт.
2. Вверху или в меню открой **Domain List** (список доменов).
3. Найди домен **liquidityscan.io** и нажми рядом кнопку **Manage**.

---

### 7.2. Открыть настройки DNS

На странице управления доменом найди раздел **DNS** или **Nameservers**. Открой вкладку **Advanced DNS** (расширенные настройки DNS).

---

### 7.3. Добавить или изменить A-записи

В таблице записей должны быть две строки для перенаправления сайта на сервер:

**Первая запись (корень домена liquidityscan.io):**
- **Type:** выбери **A Record**.
- **Host:** оставь **@** (это и есть корень домена).
- **Value** (или **Points to**): впиши **173.249.3.156** (IP твоего сервера).
- **TTL:** оставь **Automatic** или **300**.

**Вторая запись (www.liquidityscan.io):**
- **Type:** **A Record**.
- **Host:** впиши **www**.
- **Value:** **173.249.3.156**.
- **TTL:** Automatic или 300.

Если такие A-записи уже есть, но с другим IP — нажми **Edit** (карандаш) и поменяй **Value** на **173.249.3.156**.  
Записи типа TXT (DMARC, DKIM и т.п.) не трогай — они для почты.

---

### 7.4. Сохранить

Внизу страницы нажми **Save All Changes** (или зелёную галочку). Изменения DNS применяются не сразу: от 5–10 минут до 24–48 часов.

---

### 7.5. Проверить, что DNS обновился

На своём компьютере или на сервере в терминале введи:

```bash
nslookup liquidityscan.io
nslookup www.liquidityscan.io
```

В ответе должен быть адрес **173.249.3.156**. После этого переходи к шагу 8 (SSL).

---

### 7.6. Вариант: трафик через Cloudflare

Если хочешь, чтобы весь трафик шёл через Cloudflare (CDN, защита, кэш, SSL из коробки):

**7.6.1. Добавить сайт в Cloudflare**

1. Зайди на https://dash.cloudflare.com и войди в аккаунт.
2. Нажми **Add a site** → введи **liquidityscan.io** → выбери план (Free достаточно) → **Continue**.
3. Cloudflare покажет два nameserver’а (например `xxx.ns.cloudflare.com` и `yyy.ns.cloudflare.com`). Не закрывай страницу — они понадобятся в Namecheap.

**7.6.2. В Namecheap переключить домен на Cloudflare**

1. В Namecheap: **Domain List** → **Manage** у **liquidityscan.io**.
2. Раздел **Nameservers** → выбери **Custom DNS**.
3. Впиши оба nameserver’а из Cloudflare (по одному в каждое поле). Сохрани.
4. Подожди 5–30 минут (иногда до 24–48 часов), пока Cloudflare подхватит домен (статус станет **Active**).

**7.6.3. В Cloudflare настроить DNS**

1. В Cloudflare: выбери сайт **liquidityscan.io** → вкладка **DNS** → **Records**.
2. Добавь две A-записи:

| Type | Name | IPv4 address | Proxy status |
|------|------|--------------|--------------|
| A    | @    | 173.249.3.156 | **Proxied** (оранжевое облако) |
| A    | www  | 173.249.3.156 | **Proxied** (оранжевое облако) |

**Proxy status** должен быть **Proxied** (оранжевое облако) — тогда трафик идёт через Cloudflare.

**7.6.4. SSL в Cloudflare**

В Cloudflare: **SSL/TLS** → режим **Full** или **Flexible**:
- **Flexible** — шифрование только между пользователем и Cloudflare; между Cloudflare и твоим сервером — HTTP (на сервере certbot можно не ставить).
- **Full** — HTTPS и до сервера; на сервере нужен сертификат (certbot, шаг 8).

**7.6.5. Дальше**

- В **.env** бэкенда оставь `https://liquidityscan.io` в CORS_ORIGIN, FRONTEND_URL, GOOGLE_CALLBACK_URL.
- В Google OAuth (шаг 9) укажи `https://liquidityscan.io` и `https://liquidityscan.io/api/auth/google/callback` — как и без Cloudflare.
- Если выбрал **Full** SSL в Cloudflare — выполни шаг 8 (certbot на сервере). Если **Flexible** — шаг 8 можно пропустить, но тогда Nginx должен слушать 80 и отдавать сайт по HTTP (для Cloudflare этого достаточно).

После этого весь трафик к liquidityscan.io идёт через Cloudflare.

---

## Шаг 8. Включить SSL (HTTPS)

**8.1.** На сервере установи certbot (если ещё нет):

```bash
apt install -y certbot python3-certbot-nginx
```

**8.2.** Выдай сертификат для домена и www:

```bash
sudo certbot --nginx -d liquidityscan.io -d www.liquidityscan.io
```

Введи email, согласись с условиями. Certbot сам изменит конфиг Nginx для HTTPS.

**8.3.** После успеха обнови `.env` бэкенда на HTTPS (если ещё не сделал):

```bash
cd /var/www/liquidityscan/liquidityscan-web/backend
nano .env
```

Поставь:
- `GOOGLE_CALLBACK_URL=https://liquidityscan.io/api/auth/google/callback`
- `CORS_ORIGIN=https://liquidityscan.io`
- `FRONTEND_URL=https://liquidityscan.io`

Сохрани (Ctrl+O, Enter, Ctrl+X).

**8.4.** Перезапусти бэкенд:

```bash
pm2 restart liquidityscan-api
```

Сайт должен открываться по **https://liquidityscan.io**.

---

## Шаг 9. Настроить Google OAuth

**9.1.** На сервере в `.env` уже должно быть (после шага 8):
- `GOOGLE_CALLBACK_URL=https://liquidityscan.io/api/auth/google/callback`

**9.2.** В браузере открой Google Cloud Console:  
https://console.cloud.google.com/apis/credentials

**9.3.** Выбери проект и открой OAuth 2.0 Client ID (тип Web application).

**9.4.** В разделе **Authorized JavaScript origins** добавь:
- `https://liquidityscan.io`
- при необходимости `https://www.liquidityscan.io`

**9.5.** В разделе **Authorized redirect URIs** добавь:
- `https://liquidityscan.io/api/auth/google/callback`

**9.6.** Сохрани (Save). Перезапуск бэкенда уже сделан в шаге 8 — при необходимости ещё раз: `pm2 restart liquidityscan-api`.

---

## Шаг 10. Передать данные разработчику (Grno) для webhook

**10.1.** Webhook URL (после SSL):
- **https://liquidityscan.io/api/signals/webhook**

**10.2.** Preferred secret key:  
то значение, которое в `.env` на сервере записано в переменной **SIGNALS_WEBHOOK_SECRET**. Передай разработчику только эту строку (без имени переменной).

**10.3.** Кратко для разработчика:
- Метод: **POST**
- Заголовок: **x-webhook-secret:** `<значение SIGNALS_WEBHOOK_SECRET>`
- Content-Type: **application/json**
- Тело: JSON — один объект сигнала или массив объектов. Формат полей: см. файл **liquidityscan-web/backend/docs/SIGNALS_WEBHOOK_FOR_PYTHON.md** (strategyType SUPER_ENGULFING, symbol, timeframe 4h/1d/1w, signalType BUY/SELL, price и т.д.)

Ответ при успехе: `{ "received": N }`. При неверном секрете — 401.

---

## Шаг 11. Финальная проверка

Сделай по порядку:

1. Открой в браузере **https://liquidityscan.io** — загружается главная страница LiquidityScan.
2. Нажми вход через Google — после выбора аккаунта должен произойти редирект и успешный вход.
3. Открой **https://liquidityscan.io/api/signals** — в ответе JSON (массив сигналов или пустой массив).
4. Убедись, что **superengulfing** по-прежнему работает: открой https://superengulfing.com и проверь, что PM2 процессы **api** и **remix** в статусе online: `pm2 list`.

Если что-то не работает:
- логи бэкенда: `pm2 logs liquidityscan-api`
- логи Nginx: `sudo tail -100 /var/log/nginx/liquidityscan.io.error.log`

---

## Краткая последовательность (напоминание)

1. Push в GitHub  
2. SSH на сервер → установить git, Node, PM2 при необходимости  
3. Clone в `/var/www/liquidityscan`  
4. Backend: npm ci → .env → prisma generate + migrate → build → pm2 start  
5. Frontend: npm ci --legacy-peer-deps → build  
6. Nginx: скопировать конфиг для liquidityscan.io → enable → reload  
7. Namecheap: A @ и www → 173.249.3.156  
8. Certbot для liquidityscan.io и www → обновить .env на https → pm2 restart  
9. Google Console: origins и redirect URI для liquidityscan.io  
10. Передать Grno webhook URL и secret  
11. Проверить сайт, вход, API и что superengulfing не сломан  

Всё по этому файлу делается по порядку — он и есть твой компас деплоя.
